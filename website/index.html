<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <style>
    body {
      padding: 100px;
      width: 1000px;
      margin: auto;
      text-align: left;
      font-weight: 300;
      font-family: Helvetica, sans-serif;
      background-color: #232323;
      color: #dedede;
      line-height: 1.4em;
    }
    
    h1, h2, h3 {
      font-family: system-ui, Helvetica, sans-serif;
    }
    
    h1 {
      font-weight: 800;
      font-size: 60px;
    }
    
    h2 {
      color: #aaa;
      text-transform: capitalize;
      font-weight: 800;
      font-size: 48px;
      line-height: 48px;
      margin-top: 64px;
      margin-bottom: 0;
      border-left: solid #dedede 16px;
      padding-left: 16px;
    }
    
    h3 {
      font-size: 32px;
      line-height: 24px;
      margin-bottom: 0;
      margin-top: 32px;
    }
    
    .grid-2, .grid-3 {
      display: grid;
      gap: 32px;
      box-sizing: border-box;
      margin: 32px 0;
      width: 100%;
    }
    
    .grid-2 {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .grid-3 {
      grid-template-columns: repeat(3, 1fr);
    }
    
    figure {
      display: flex;
      flex-direction: column;
      position: relative;
      min-width: 240px;
      max-width: 500px;
      border-radius: 32px;
      background-color: #1f1f1f;
      overflow: hidden;
      box-shadow: rgba(0, 0, 0, 0.5) 0 0 16px;
      margin: 0;
    }
    
    img {
      width: 100%;
    }
    
    figcaption {
      font-style: italic;
      text-align: center;
      height: 32px;
      line-height: 32px;
      background-color: #000000;
    }

    code {
      font-size: 1.2em;
      background-color: #3d3d3d;
      padding-left: 4px;
      padding-right: 4px;
      border-radius: 4px;
    }
  </style>
  <title>CS 184 Cloth Simulator</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
</head>
<body>
  <h1>Project 4: Cloth Simulator</h1>
  <p>
      CS 184: Computer Graphics and Imaging, Spring 2021 <br />
      Richard Yan
  </p>
  <h2>Overview</h2>
  <p>
    This projects implements a cloth simulator based on a spring/mass model, with collision physics with external objects as well as the cloth itself. In addition, GLSL shaders are used to shade the cloth.
  </p>
  <h2>Part 1: Masses and Springs</h2>
  <p>
    Connecting the grid of masses are three types of springs: structural (between direct neighbors), shearing (between diagonal neighbors) and bending (between nodes with distance 2 apart).
  </p>
  <p>
    Springs of <code>pinned2.json</code>:
  </p>
  <div class="grid-2">
      <figure>
          <img src="images/1_1.png" />
      </figure>
      <figure>
          <img src="images/1_2.png" />
      </figure>
  </div>
  <div class="grid-3">
    <figure>
        <img src="images/1_3.png" />
        <figcaption>Without shearing constraints</figcaption>
    </figure>
    <figure>
        <img src="images/1_4.png" />
        <figcaption>With only shearing constraitns</figcaption>
    </figure>
    <figure>
        <img src="images/1_1.png" />
        <figcaption>All constraints</figcaption>
    </figure>
  </div>
  <h2>Part 2: Simulation via Numerical Integration</h2>
  <p>
    Basic simulation is implemented using Verlet Integration. Different parameters have different effects on the simulation: <br />
    <i>All simulations from this point forward uses 0.2 times <code>ks</code> for bending constraints.</i>
  </p>
  <ul>
    <li>
      A low spring constant <code>ks</code> makes the simulation unstable and the cloth very stretchy/bouncy. On the other hand, a high <code>ks</code> makes the simulation stable and the cloth stiff.
      <div class="grid-2">
        <figure>
          <img src="images/2_1.png" />
          <figcaption>Low <code>ks</code></figcaption>  
        </figure>
        <figure>
          <img src="images/2_2.png" />
          <figcaption>High <code>ks</code></figcaption>  
        </figure>
      </div>
    </li>
    <li>
      A low density value results in a piece of cloth that stretches very little (the arc is straighter). On the other hand, a high density value stretches the cloth quite a lot, which is expected as it's heavier. Density value, however, has little impact on simulation speed and bounciness.
      <div class="grid-2">
        <figure>
          <img src="images/2_3.png" />
          <figcaption>Low <code>density</code></figcaption>  
        </figure>
        <figure>
          <img src="images/2_4.png" />
          <figcaption>High <code>density</code></figcaption>  
        </figure>
      </div>
    </li>
    <li>
      A low damping value causes a very unstable simulation, with waves propagating along the cloth violently. It also converges to rest slower. On the other hand, a high damping value is very stable, but the cloth falls somewhat slower with little to no visible waves.
      <div class="grid-2">
        <figure>
          <img src="images/2_5.png" />
          <figcaption>Low <code>damping</code></figcaption>  
        </figure>
        <figure>
          <img src="images/2_6.png" />
          <figcaption>High <code>damping</code></figcaption>  
        </figure>
      </div>
    </li>
  </ul>
  <p>
    A simulation of <code>pinned4.json</code> under default parameters:
  </p>
  <figure>
    <img src="images/2_7.png" />
  </figure>
  <h2>Part 3: Collisions with Other Objects</h2>
  <p>
    Collision simulation is achieved by checking each mass against all objects, and placing the mass on the surface if it's inside the object. Some images of a piece of cloth with different <code>ks</code> values falling on a sphere:
  </p>
  <div class="grid-3">
    <figure>
      <img src="images/3_1.png" />
      <figcaption><code>ks</code>=500</figcaption>  
    </figure>
    <figure>
      <img src="images/3_2.png" />
      <figcaption><code>ks</code>=5000</figcaption>  
    </figure>
    <figure>
      <img src="images/3_3.png" />
      <figcaption><code>ks</code>=50000</figcaption>  
    </figure>
  </div>
  <p>
    Here's the cloth resting on a plane:
  </p>
  <figure>
    <img src="images/3_4.png" />
  </figure>
  <h2>Part 4: Self Collision</h2>
  <p>
    An approximation of self collision is done through spatial hashing and applying corrective vectors if two masses with the same hash comes too close.
  </p>
  <p>
    Here are some images demonstrating the folding process:
  </p>
  <div class="grid-3">
    <figure>
      <img src="images/4_1.png" />
    </figure>
    <figure>
      <img src="images/4_2.png" />
    </figure>
    <figure>
      <img src="images/4_3.png" />
    </figure>
  </div>
  <p>
    With different <code>ks</code> values the simulation behaves very different. With low <code>ks</code> the simulation is bouncy and unstable as it usually is, and the result seems more layered. With high ks, there's very little wrinkle, the cloth falls stiffly and spreads out as it lands.
  </p>
  <div class="grid-3">
    <figure>
      <img src="images/4_4.png" />
      <figcaption><code>ks</code>=1000</figcaption>  
    </figure>
    <figure>
      <img src="images/4_5.png" />
      <figcaption><code>ks</code>=5000</figcaption>  
    </figure>
    <figure>
      <img src="images/4_6.png" />
      <figcaption><code>ks</code>=10000</figcaption>  
    </figure>
  </div>
  <p>
    With different <code>density</code> the cloth falls differently. With low density, the cloth folds on itself throughout its height very early on, and the waves are larger. With high density, the cloth wrinkles tightly, mostly concentrated on the lower portions initially, and has more layers at rest.
  </p>
  <div class="grid-2">
    <figure>
      <img src="images/4_7.png" />
      <figcaption><code>density</code>=1</figcaption>  
    </figure>
    <figure>
      <img src="images/4_8.png" />
      <figcaption><code>density</code>=1</figcaption>  
    </figure>
    <figure>
      <img src="images/4_9.png" />
      <figcaption><code>density</code>=100</figcaption>  
    </figure>
    <figure>
      <img src="images/4_10.png" />
      <figcaption><code>density</code>=100</figcaption>  
    </figure>
  </div>
  <h2>Part 5: Shaders</h2>
  <p>
    Shader programs are programs that computes the look and feel based on lighting and material inputs for 3D scenes. Vertex shaders are run on vertices, fragment shaders are run on fragments, with input data (e.g. normal, uv coordinates) interpolated from the vertex shader outputs. Because there are usually a lot less vertices than fragments, vertex shaders can afford to be a little more expensive; their outputs are interpolated for fragment shaders to generate a "smooth" output. Computing lighting in fragment shaders results in Phong shading, while computing lighting in vertex shaders results in gouraud shading.
  </p>
  <h3>Blinn-Phong shader</h3>
  <p>
    The Blinn-Phong shading model is an approximation of a material with both ambient, diffuse and specular components. Ambient is applied uniformly to all fragments. Diffuse is based on the angle the incident light makes with the surface and the illuminance. Specular adds the viewing direction into play and approximates a concentrated reflection using a power of cosine.
  </p>
  <div class="grid-2">
    <figure>
      <img src="images/5_1.png" />
      <figcaption>Ambient (not completely black)</figcaption>  
    </figure>
    <figure>
      <img src="images/5_2.png" />
      <figcaption>Diffuse</figcaption>  
    </figure>
    <figure>
      <img src="images/5_3.png" />
      <figcaption>Specular</figcaption>  
    </figure>
    <figure>
      <img src="images/5_4.png" />
      <figcaption>Combined</figcaption>
    </figure>
  </div>
  <h3>Texture mapping shader</h3>
  <div class="grid-2">
    <figure>
      <img src="images/5_5.png" />
    </figure>
    <figure>
      <img src="images/5_6.png" />
    </figure>
  </div>
  <h3>Bump mapping shader</h3>
  <div class="grid-2">
    <figure>
      <img src="images/5_7.png" />
      <figcaption>Sphere</figcaption>  
    </figure>
    <figure>
      <img src="images/5_8.png" />
      <figcaption>Cloth</figcaption>  
    </figure>
  </div>
  <h3>Displacement mapping shader</h3>
  <div class="grid-2">
    <figure>
      <img src="images/5_9.png" />
      <figcaption>Sphere</figcaption>  
    </figure>
    <figure>
      <img src="images/5_10.png" />
      <figcaption>Cloth</figcaption>  
    </figure>
  </div>
  <h3>Bump vs. Displacement on different sphere resolutions</h3>
  <p>
    Resolution has no impact on bump map, since only the interpolated normals are changed; it does have an impact on displacement map, since the vertices are physically moved - and higher the resolution sphere has more vertices for more details.
  </p>
  <div class="grid-2">
    <figure>
      <img src="images/5_11.png" />
      <figcaption>Bump, 16x16</figcaption>  
    </figure>
    <figure>
      <img src="images/5_12.png" />
      <figcaption>Displacement, 16x16</figcaption>  
    </figure>
    <figure>
      <img src="images/5_13.png" />
      <figcaption>Bump, 128x128</figcaption>  
    </figure>
    <figure>
      <img src="images/5_14.png" />
      <figcaption>Displacement, 128x128</figcaption>  
    </figure>
  </div>
  <h3>Mirror Shader</h3>
  <div class="grid-2">
    <figure>
      <img src="images/5_15.png" />
      <figcaption>Sphere</figcaption>  
    </figure>
    <figure>
      <img src="images/5_16.png" />
      <figcaption>Cloth</figcaption>  
    </figure>
  </div>
  <h3>(EC) Checkerboard Shader</h3>
  <p>
    This shader is based on the Blinn-Phong shader, but the diffuse color is a procedurally-generated checkerboard pattern. It is generated by scaling the UV coordinates, snapping it to the nearest integer, adding them and taking the parity of the result.
  </p>
  <figure>
    <img src="images/5_17.png" />
  </figure>
  <h3>(EC) Roughness Shader</h3>
  <p>
    This shader takes in a roughness texture that determines the coefficients for the diffuse and specular shaders. The rougher the material, the more diffusion. In the image, the sphere and the cloth are both a uniform dark gray color, but show a pattern due to the difference in roughness.
  </p>
  <div class="grid-2">
    <figure>
      <img src="images/5_18.png" />
      <figcaption>Sphere</figcaption>  
    </figure>
    <figure>
      <img src="images/5_19.png" />
      <figcaption>Cloth</figcaption>  
    </figure>
  </div>
</body>
</html>
